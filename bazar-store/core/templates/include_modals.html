<!-- Include all modals and their related scripts -->

<!-- Include Purchase History Modal -->
{% include 'history_modal.html' %}

<!-- Include Purchase Error Modal -->
{% include 'purchase_error_modal.html' %}

<!-- Include Purchase Success Modal -->
{% include 'purchase_success_modal.html' %}

<!-- Scripts for modals -->
<script src="/static/js/history.js"></script>

<script>
    // Initialize modals when document is ready
    document.addEventListener('DOMContentLoaded', function() {
        // Add event listeners for showing purchase history
        const historyLinks = document.querySelectorAll('[data-action="show-history"]');
        historyLinks.forEach(link => {
            link.addEventListener('click', function() {
                if (window.historyModule && window.historyModule.showPurchaseHistory) {
                    window.historyModule.showPurchaseHistory();
                }
            });
        });
        
        // Enable checkout button when cart has items
        const checkoutBtn = document.getElementById('checkoutBtn');
        if (checkoutBtn) {
            const updateCheckoutButton = function() {
                const cartItems = window.specialOffers && window.specialOffers.getCartItems ? 
                    window.specialOffers.getCartItems() : [];
                checkoutBtn.disabled = cartItems.length === 0;
            };
            
            // Update button state initially and when cart changes
            updateCheckoutButton();
            
            // Set interval to periodically check cart state
            setInterval(updateCheckoutButton, 1000);
        }
    });
</script>